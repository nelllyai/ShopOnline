(()=>{"use strict";const t=t=>JSON.parse(localStorage.getItem(t))||[],e=()=>{const e=t("cart").reduce(((t,e)=>t+e.quantity),0);document.querySelector(".header__link_cart").dataset.total=e},n=document.querySelector(".header__menu-button"),c=document.querySelector(".menu");n.addEventListener("click",(()=>{n.classList.toggle("header__menu-button_close"),c.classList.toggle("menu_active")})),e();const a=document.querySelectorAll(".footer__list_cover");document.querySelectorAll(".footer__button").forEach(((t,e)=>{t.addEventListener("click",(()=>{t.classList.toggle("footer__button_active");for(let t=0;t<a.length;t++)e===t&&a[t].classList.toggle("footer__list_active")}))}));const o=t=>{const e=document.createElement("li");e.className="footer__item";const n=document.createElement("a");return n.className="footer__link",n.href="category.html?search="+t,n.textContent=t,e.append(n),e},s=t=>{const e=document.createElement("li");e.className="menu__item";const n=document.createElement("a");return n.className="menu__link",n.href="category.html?search="+t,n.textContent=t,e.append(n),e};(async()=>{const t=await(async()=>{const t=await fetch("https://shorthaired-veiled-fascinator.glitch.me/api/category");return await t.json()})(),e=document.querySelector(".footer__list_two-cols"),n=document.querySelector(".menu__list_two-cols");e.append(...t.map(o)),n.append(...t.map(s))})();const i=e=>t("cart").find((t=>t.id===e)),r=(n,c)=>{n.addEventListener("click",(()=>{const n=i(c);n?((e,n,c,a)=>{const o=t(e),s=o.findIndex((t=>t.id===n));o[s][c]=a,localStorage.setItem(e,JSON.stringify(o))})("cart",c,"quantity",n.quantity+1):((e,n)=>{const c=t(e);c.push(n),localStorage.setItem(e,JSON.stringify(c))})("cart",{id:c,quantity:1}),e()}))},d=t=>`${t.toFixed(2)} ₽`,l=(t,e,n)=>e*(t-t*n/100),_=t=>"image/notimage.jpg"===t?"./img/no-image.png":`https://shorthaired-veiled-fascinator.glitch.me/${t}`,u=({id:t,title:e,price:n,discount:c,image:a})=>{const o=document.createElement("li");o.className="card";const s=_(a);return o.innerHTML=`\n  <a href="product.html?id=${t}" class="card__link">\n    <div class="card__image-wrapper">\n      <img src="${s}" alt="${e}" class="card__image" width="420" height="295">\n      ${c>0?`<div class="card__discount">-${c}%</div>`:""}\n    </div>\n  \n    <div class="card__price">\n      <p class="card__new-price">${d(l(n,1,c))} ₽</p>\n      ${c>0?`\n      <p class="card__old-price">\n        <span class="visually-hidden">Старая цена</span>${n} ₽\n      </p>\n      `:""}\n    </div>\n  \n    <p class="card__product">${e}</p>\n  </a>\n  `,o},p="https://shorthaired-veiled-fascinator.glitch.me",m=async()=>{const t=await fetch(`${p}/api/goods`);return await t.json()},h=async t=>{const e=await fetch(`${p}/api/goods/${t}`);return await e.json()},g=async(t,{category:e})=>{const n=await(async t=>(await m()).filter((e=>e.category.toLowerCase().startsWith(t.toLowerCase()))))(e),c=document.createElement("h2");c.classList.add("subtitle","recommendation__title"),c.textContent="Рекомендуем также";const a=document.createElement("ul");a.className="recommendation__list";const o=n.map(u);a.append(...o),t.append(c,a)};(async()=>{const t=new URL(window.location.href).searchParams.get("id"),e=await h(t),n=document.querySelector(".product__container"),c=document.querySelector(".recommendation__container"),a=document.querySelector(".navigation-chain__item_category"),o=document.querySelector(".navigation-chain__item_title"),s=document.createElement("h1");s.classList.add("subtitle","product__title"),s.textContent=e.title;const i=document.createElement("hr");i.className="product__hr";const u=(({title:t,price:e,discount:n,image:c})=>{const a=document.createElement("div");a.className="product__wrapper";const o=_(c);return a.innerHTML=`\n    <div class="product__image-wrapper">\n      <img src="${o}" alt="${t}" class="product__image" width="757" height="427">\n      ${n>0?`<div class="product__discount">-${n}%</div>`:""}\n    </div>\n\n    <div class="product__info">\n      <div class="product__price">\n        <p class="product__new-price">${d(l(e,1,n))}</p>\n        ${n>0?`\n        <p class="product__old-price">\n          <span class="visually-hidden">Старая цена</span>${e} ₽\n        </p>\n        `:""}\n      </div>\n\n      <p class="product__credit">В кредит от ${d(((t,e)=>t*1*.05)(e))}</p>\n\n      <div class="product__control">\n        <button class="button product__to-cart">Добавить в корзину</button>\n        <button class="product__to-favourite">\n          <svg width="29" height="26" viewBox="0 0 29 26" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path\n              d="M20.6875 0.125C18.295 0.125 15.9987 1.23875 14.5 2.99875C13.0012 1.23875 10.705 0.125 8.3125 0.125C4.0775 0.125 0.75 3.4525 0.75 7.6875C0.75 12.885 5.425 17.12 12.5062 23.555L14.5 25.3563L16.4937 23.5413C23.575 17.12 28.25 12.885 28.25 7.6875C28.25 3.4525 24.9225 0.125 20.6875 0.125ZM14.6375 21.5062L14.5 21.6437L14.3625 21.5062C7.8175 15.58 3.5 11.6613 3.5 7.6875C3.5 4.9375 5.5625 2.875 8.3125 2.875C10.43 2.875 12.4925 4.23625 13.2212 6.12H15.7925C16.5075 4.23625 18.57 2.875 20.6875 2.875C23.4375 2.875 25.5 4.9375 25.5 7.6875C25.5 11.6613 21.1825 15.58 14.6375 21.5062Z"\n              fill="#3670C7" />\n          </svg>\n        </button>\n      </div>\n\n      <div class="product__main-info">\n        <div class="product__info-wrapper">\n          <p class="product__info-title">Доставка</p>\n          <div class="product__info-description">1-3 января</div>\n        </div>\n\n        <div class="product__info-wrapper">\n          <p class="product__info-title">Продавец</p>\n          <div class="product__info-description">ShopOnline</div>\n        </div>\n      </div>\n\n      <button class="product__notification">Узнать о снижении цены</button>\n    </div>\n  `,a})(e),p=(({description:t})=>{const e=document.createElement("div");e.className="product__more-info";const n=document.createElement("p");n.className="product__subtitle",n.textContent="Описание:";const c=document.createElement("p");return c.className="product__description",c.textContent=t,e.append(n,c),e})(e);n.append(s,i,u,p),g(c,e),((t,e,{title:n,category:c})=>{const a=document.createElement("a");a.className="navigation-chain__link",a.href="category.html?search="+c,a.textContent=c,e.textContent=n,t.append(a)})(a,o,e);const m=document.querySelector(".product__to-cart");r(m,+t)})()})();