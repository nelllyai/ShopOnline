(()=>{"use strict";const t=t=>JSON.parse(localStorage.getItem(t))||[],e=()=>{const e=t("cart").reduce(((t,e)=>t+e.quantity),0);document.querySelector(".header__link_cart").dataset.total=e},c=document.querySelector(".header__menu-button"),n=document.querySelector(".menu");c.addEventListener("click",(()=>{c.classList.toggle("header__menu-button_close"),n.classList.toggle("menu_active")})),e();const a=document.querySelectorAll(".footer__list_cover");document.querySelectorAll(".footer__button").forEach(((t,e)=>{t.addEventListener("click",(()=>{t.classList.toggle("footer__button_active");for(let t=0;t<a.length;t++)e===t&&a[t].classList.toggle("footer__list_active")}))}));const o=t=>{const e=document.createElement("li");e.className="footer__item";const c=document.createElement("a");return c.className="footer__link",c.href="category.html?search="+t,c.textContent=t,e.append(c),e},r=t=>{const e=document.createElement("li");e.className="menu__item";const c=document.createElement("a");return c.className="menu__link",c.href="category.html?search="+t,c.textContent=t,e.append(c),e};(async()=>{const t=await(async()=>{const t=await fetch("https://shorthaired-veiled-fascinator.glitch.me/api/category");return await t.json()})(),e=document.querySelector(".footer__list_two-cols"),c=document.querySelector(".menu__list_two-cols");e.append(...t.map(o)),c.append(...t.map(r))})();const s=t=>Math.round(100*t)/100+" ₽",i=(t,e,c)=>e*(t-t*c/100),l=e=>t("cart").find((t=>t.id===e)),d=(c,n)=>{c.addEventListener("click",(()=>{const c=l(n);c?((e,c,n,a)=>{const o=t(e),r=o.findIndex((t=>t.id===c));o[r][n]=a,localStorage.setItem(e,JSON.stringify(o))})("cart",n,"quantity",c.quantity+1):((e,c)=>{const n=t(e);n.push(c),localStorage.setItem(e,JSON.stringify(n))})("cart",{id:n,quantity:1,checked:!0}),e()}))},u=t=>"image/notimage.jpg"===t?"./img/no-image.png":`https://shorthaired-veiled-fascinator.glitch.me/${t}`,m=({id:t,title:e,price:c,discount:n,image:a})=>{const o=document.createElement("li");o.className="card",o.tabIndex="0";const r=u(a);return o.innerHTML=`\n  <a href="product.html?id=${t}" class="card__link">\n    <div class="card__image-wrapper">\n      <img src="${r}" alt="${e}" class="card__image" width="420" height="295">\n      ${n>0?`<div class="card__discount">-${n}%</div>`:""}\n    </div>\n  \n    <div class="card__price">\n      <p class="card__new-price">${s(i(c,1,n))}</p>\n      ${n>0?`\n      <p class="card__old-price">\n        <span class="visually-hidden">Старая цена</span>${c} ₽\n      </p>\n      `:""}\n    </div>\n  \n    <p class="card__product">${e}</p>\n  </a>\n  `,o},_="https://shorthaired-veiled-fascinator.glitch.me",p=async()=>{const t=await fetch(`${_}/api/goods`);return await t.json()},h=async(t,{category:e})=>{const c=await(async t=>(await p()).filter((e=>e.category.toLowerCase().startsWith(t.toLowerCase()))))(e),n=document.createElement("h2");n.classList.add("subtitle","recommendation__title"),n.textContent="Рекомендуем также";const a=document.createElement("ul");a.className="recommendation__list";const o=c.map(m);a.append(...o),t.append(n,a)};window.onload=function(){(async()=>{const t=new URL(window.location.href).searchParams.get("id"),e=await(async t=>{const e=await fetch(`${_}/api/goods/${t}`);return await e.json()})(t),{title:c,price:n,category:a,image:o,description:r,discount:l}=e,m=document.querySelector(".product__container"),p=document.querySelector(".navigation-chain__link_category");if(p.href="category.html?search="+a,p.textContent=a,document.querySelector(".navigation-chain__item_title").textContent=c,m.querySelector("h1").textContent=c,m.querySelector(".product__image").src=u(o),m.querySelector(".product__new-price").textContent=s(i(n,1,l)),l>0){const t=document.createElement("p");t.className="product__old-price",t.textContent=s(((t,e)=>t*1)(n)),m.querySelector(".product__price").append(t)}document.querySelector(".product__description").textContent=r;const g=document.querySelector(".recommendation__container");h(g,e);const y=document.querySelector(".product__to-cart");d(y,+t)})()}})();