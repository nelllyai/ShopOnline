(()=>{"use strict";const t=t=>JSON.parse(localStorage.getItem(t))||[],e=()=>{const e=t("cart").reduce(((t,e)=>t+e.quantity),0);document.querySelector(".header__link_cart").dataset.total=e},n=document.querySelector(".header__menu-button"),c=document.querySelector(".menu");n.addEventListener("click",(()=>{n.classList.toggle("header__menu-button_close"),c.classList.toggle("menu_active")})),e();const a=document.querySelectorAll(".footer__list_cover");document.querySelectorAll(".footer__button").forEach(((t,e)=>{t.addEventListener("click",(()=>{t.classList.toggle("footer__button_active");for(let t=0;t<a.length;t++)e===t&&a[t].classList.toggle("footer__list_active")}))}));const o=t=>{const e=document.createElement("li");e.className="footer__item";const n=document.createElement("a");return n.className="footer__link",n.href="category.html?search="+t,n.textContent=t,e.append(n),e},r=t=>{const e=document.createElement("li");e.className="menu__item";const n=document.createElement("a");return n.className="menu__link",n.href="category.html?search="+t,n.textContent=t,e.append(n),e};(async()=>{const t=await(async()=>{const t=await fetch("https://shorthaired-veiled-fascinator.glitch.me/api/category");return await t.json()})(),e=document.querySelector(".footer__list_two-cols"),n=document.querySelector(".menu__list_two-cols");e.append(...t.map(o)),n.append(...t.map(r))})();const s=t=>Math.round(100*t)/100+" ₽",i=(t,e,n)=>e*(t-t*n/100),l=e=>t("cart").find((t=>t.id===e)),d=(n,c)=>{n.addEventListener("click",(()=>{const n=l(c);n?((e,n,c,a)=>{const o=t(e),r=o.findIndex((t=>t.id===n));o[r][c]=a,localStorage.setItem(e,JSON.stringify(o))})("cart",c,"quantity",n.quantity+1):((e,n)=>{const c=t(e);c.push(n),localStorage.setItem(e,JSON.stringify(c))})("cart",{id:c,quantity:1}),e()}))},u=t=>"image/notimage.jpg"===t?"./img/no-image.png":`https://shorthaired-veiled-fascinator.glitch.me/${t}`,m=({id:t,title:e,price:n,discount:c,image:a})=>{const o=document.createElement("li");o.className="card",o.tabIndex="0";const r=u(a);return o.innerHTML=`\n  <a href="product.html?id=${t}" class="card__link">\n    <div class="card__image-wrapper">\n      <img src="${r}" alt="${e}" class="card__image" width="420" height="295">\n      ${c>0?`<div class="card__discount">-${c}%</div>`:""}\n    </div>\n  \n    <div class="card__price">\n      <p class="card__new-price">${s(i(n,1,c))}</p>\n      ${c>0?`\n      <p class="card__old-price">\n        <span class="visually-hidden">Старая цена</span>${n} ₽\n      </p>\n      `:""}\n    </div>\n  \n    <p class="card__product">${e}</p>\n  </a>\n  `,o},_="https://shorthaired-veiled-fascinator.glitch.me",p=async()=>{const t=await fetch(`${_}/api/goods`);return await t.json()},g=async(t,{category:e})=>{const n=await(async t=>(await p()).filter((e=>e.category.toLowerCase().startsWith(t.toLowerCase()))))(e),c=document.createElement("h2");c.classList.add("subtitle","recommendation__title"),c.textContent="Рекомендуем также";const a=document.createElement("ul");a.className="recommendation__list";const o=n.map(m);a.append(...o),t.append(c,a)};window.onload=function(){(async()=>{const t=new URL(window.location.href).searchParams.get("id"),e=await(async t=>{const e=await fetch(`${_}/api/goods/${t}`);return await e.json()})(t),{title:n,price:c,category:a,image:o,description:r,discount:l}=e,m=document.querySelector(".product__container"),p=document.querySelector(".navigation-chain__link_category");if(p.href="category.html?search="+a,p.textContent=a,document.querySelector(".navigation-chain__item_title").textContent=n,m.querySelector("h1").textContent=n,m.querySelector(".product__image").src=u(o),m.querySelector(".product__new-price").textContent=s(i(c,1,l)),l>0){const t=document.createElement("p");t.className="product__old-price",t.textContent=s(((t,e)=>t*1)(c)),m.querySelector(".product__price").append(t)}document.querySelector(".product__description").textContent=r;const h=document.querySelector(".recommendation__container");g(h,e);const y=document.querySelector(".product__to-cart");d(y,+t)})()}})();